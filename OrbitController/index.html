<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>Homburg Orbit Controller</title>
		<style>
			
		</style>
        <link rel="stylesheet" type="text/css" href="assets/style.css">
	</head>
	<body>
		<script src="scripts/three.js"></script>
		<script src="scripts/ColladaLoader.js"></script>
		<script src="scripts/OrbitControls.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
		<script src="scripts/jquery.simpler-sidebar.min.js"></script>
		<script>
            $(document).ready(function() {				
                $('#main-sidebar').simplerSidebar({
                    opener: '#toggle-sidebar',
                    top: 42,
                    animation: {
                        easing: "easeOutQuint"
                    },
                    sidebar: {
                        align: 'left',
                        closingLinks: '.close-sb'
                    }
                });
            });
        </script>		
		
		<!-- div #main .main-content -->
        <div id="main-navbar" class="main-navbar main-navbar-fixed-top">
            <div class="main-navbar-content">
                <div id="toggle-sidebar" class="icon left">
                    <img alt="menu" src="assets/menu32@64.png" width=24px height="24px">
                </div>
            </div>
        </div>
        <!-- div #main-navbar .main-navbar .main-navbar-fixed-top -->

        <div id="main-sidebar" class="main-sidebar main-sidebar-left">
            <div id="main-sidebar-wrapper" class="main-sidebar-wrapper"></div>
        </div>
        <!-- #main-sidebar .main-sidebar .main-sidebar-left -->
		
		<div id="info">
			<b>mausrad</b> zoom, <b>linke maustaste</b> modell drehen, <b>rechte maustaste</b> modell ziehen<br/>
		</div>
		
        
		<script type="x-shader/x-vertex" id="vertexShader">
			varying vec3 vWorldPosition;
			void main() {
				vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
				vWorldPosition = worldPosition.xyz;
				gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			}
		</script>
		<script type="x-shader/x-fragment" id="fragmentShader">
			uniform vec3 topColor;
			uniform vec3 bottomColor;
			uniform float offset;
			uniform float exponent;

			varying vec3 vWorldPosition;

			void main() {
				float h = normalize( vWorldPosition + offset ).y;
				gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , 0.0), exponent ), 0.0 ) ), 1.0 );
			}
		</script>
		<script>			    
			var scene, camera, renderer;
			init();
			function init() {
			  scene = new THREE.Scene();
			  var WIDTH = window.innerWidth,
			  HEIGHT = window.innerHeight;
			  renderer = new THREE.WebGLRenderer({antialias:true});
			  renderer.setSize(WIDTH, HEIGHT);
			  document.body.appendChild(renderer.domElement);
			  camera = new THREE.PerspectiveCamera(45, WIDTH / HEIGHT, 0.1, 10000);
			  camera.position.set(800,800,800);
			  scene.add(camera);
			  
			  window.addEventListener('resize', function() {
				var WIDTH = window.innerWidth,
				HEIGHT = window.innerHeight;
				renderer.setSize(WIDTH, HEIGHT);
				camera.aspect = WIDTH / HEIGHT;
				camera.updateProjectionMatrix();
			  });
			  
			  // LIGHTS
			  dirLight = new THREE.DirectionalLight( 0xffffff, 1 );
			  dirLight.color.setHSL( 0.1, 1, 0.95 );
			  dirLight.position.set( -1, 1.75, 1 );
			  dirLight.position.multiplyScalar( 50 );
			  scene.add( dirLight );

			  dirLight.castShadow = true;

			  dirLight.shadowMapWidth = 2048;
			  dirLight.shadowMapHeight = 2048;

			  var d = 50;

			  dirLight.shadowCameraLeft = -d;
			  dirLight.shadowCameraRight = d;
			  dirLight.shadowCameraTop = d;
			  dirLight.shadowCameraBottom = -d;

			  dirLight.shadowCameraFar = 3500;
			  dirLight.shadowBias = -0.0001;
			  dirLight.shadowDarkness = 0.35;

			  
			  // GROUND
			  var groundGeo = new THREE.PlaneBufferGeometry( 10000, 10000 );
			  var groundMat = new THREE.MeshPhongMaterial( { color: 0xffffff, specular: 0x050505 } );
			  groundMat.color = new THREE.Color( 0xA2A371 );

			  var ground = new THREE.Mesh( groundGeo, groundMat );
			  ground.rotation.x = -Math.PI/2;
			  ground.position.y = -33;
			  scene.add( ground );

			  // SKYDOME
			  var vertexShader = document.getElementById( 'vertexShader' ).textContent;
			  var fragmentShader = document.getElementById( 'fragmentShader' ).textContent;
			  var uniforms = {
				topColor: 	 { type: "c", value: new THREE.Color( 0x0077ff ) },
				bottomColor: { type: "c", value: new THREE.Color( 0xffffff ) },
				offset:		 { type: "f", value: 33 },
				exponent:	 { type: "f", value: 0.6 }
			  };

			  var skyGeo = new THREE.SphereGeometry( 4000, 32, 15 );
			  var skyMat = new THREE.ShaderMaterial( { vertexShader: vertexShader, fragmentShader: fragmentShader, uniforms: uniforms, side: THREE.BackSide } );

			  var sky = new THREE.Mesh( skyGeo, skyMat );
			  scene.add( sky );
			  
			  // MODEL          
			  var loader = new THREE.ColladaLoader();
			  loader.options.convertUpAxis = true;
			  loader.load( 'model.dae', function ( collada ) {
				var dae = collada.scene;
				
				dae.traverse(function(child){
					if (child instanceof THREE.Mesh){        
						child.material.side = THREE.DoubleSide;        
					}        
				});          
				
				
				var skin = collada.skins[ 0 ];
				dae.position.set(0,0,0);
				dae.scale.set(1.5,1.5,1.5);
				scene.add(dae);
				
				animate();
			  });
			   
			  controls = new THREE.OrbitControls(camera, renderer.domElement);
			  controls.maxPolarAngle = Math.PI/2;
			  controls.maxDistance = 2500;
			}
			
			function animate() {
			  requestAnimationFrame(animate);
			  renderer.render(scene, camera);
			  controls.update();
			}
		</script>
	</body>
</html>