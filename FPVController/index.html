<!DOCTYPE html>

<html>

<head>
    <title>Homburg First Person Controller</title>
    <script src="scripts/three.js"></script>
    <script src="scripts/FirstPersonControls.js"></script>
		<script src="scripts/ColladaLoader.js"></script>

		<style>
			body {
				background:#000;
				color: #eee;
				padding:0;
				margin:0;
				font-weight:bold;
				overflow:hidden;

				font-family:Monospace;
				font-size:13px;
				text-align:center;
			}

			#info {
				position: absolute;
				top: 0px; width: 100%;
				padding: 5px;
				z-index:100;
			}

			a {

				color: #0080ff;
			}

			b { color:orange }
		</style>
</head>
<body>


		<div id="info"><a href="https://www.cs.technik.fhnw.ch/homburg3d/OrbitController/" target="_blank">zum orbit controller</a> - homburg [first person flight controls]<br/><br/>
		<b>WASD</b> move, <b>R|F</b> up | down, <b>up|down</b> pitch, <b>left|right</b> yaw<br/>
		</div>
<script type="x-shader/x-vertex" id="vertexShader">
    varying vec3 vWorldPosition;
    void main() {
      vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
      vWorldPosition = worldPosition.xyz;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
    }
  </script>
  <script type="x-shader/x-fragment" id="fragmentShader">
    uniform vec3 topColor;
    uniform vec3 bottomColor;
    uniform float offset;
    uniform float exponent;

    varying vec3 vWorldPosition;

    void main() {
      float h = normalize( vWorldPosition + offset ).y;
      gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , 0.0), exponent ), 0.0 ) ), 1.0 );
    }
  </script>

<!-- Javascript code that runs our Three.js examples -->
<script type="text/javascript">

    // once everything is loaded, we run our Three.js stuff.
    function init() {


        var clock = new THREE.Clock();


          scene = new THREE.Scene();
          var WIDTH = window.innerWidth,
          HEIGHT = window.innerHeight;
          renderer = new THREE.WebGLRenderer({antialias:true});
          renderer.setSize(WIDTH, HEIGHT);
          document.body.appendChild(renderer.domElement);
          camera = new THREE.PerspectiveCamera(45, WIDTH / HEIGHT, 0.1, 10000);
          camera.position.set(-880,700,1300);
          camera.lookAt(new THREE.Vector3(1, 1, 1));
          scene.add(camera);
          
          window.addEventListener('resize', function() {
            var WIDTH = window.innerWidth,
            HEIGHT = window.innerHeight;
            renderer.setSize(WIDTH, HEIGHT);
            camera.aspect = WIDTH / HEIGHT;
            camera.updateProjectionMatrix();
          });



        var camControls = new THREE.FirstPersonControls(camera);
        camControls.lookSpeed = 0.2;
        camControls.movementSpeed = 250;
        camControls.noFly = true;
        camControls.lookVertical = true;
        camControls.constrainVertical = false;
        camControls.verticalMin = 1.0;
        camControls.verticalMax = 2.0;
        camControls.lon = 300;
        camControls.lat = -20;
        camControls.mouseBlockWidth = 300;
        camControls.mouseBlockHeight = 300;
        
        
        // LIGHTS
        var d = 50;
        dirLight = new THREE.DirectionalLight( 0xffffff, 1 );
        dirLight.color.setHSL( 0.1, 1, 0.95 );
        dirLight.position.set( -1, 1.75, 1 );
        dirLight.position.multiplyScalar( 50 );
        scene.add( dirLight );

        dirLight.castShadow = true;
        dirLight.shadowMapWidth = 2048;
        dirLight.shadowMapHeight = 2048;
        dirLight.shadowCameraLeft = -d;
        dirLight.shadowCameraRight = d;
        dirLight.shadowCameraTop = d;
        dirLight.shadowCameraBottom = -d;
        dirLight.shadowCameraFar = 3500;
        dirLight.shadowBias = -0.0001;
        dirLight.shadowDarkness = 0.35;
        
        dirLight = new THREE.DirectionalLight( 0xffffff, 1 );
        dirLight.color.setHSL( 0.1, 1, 0.95 );
        dirLight.position.set( 1, -1.75, 1 );
        dirLight.position.multiplyScalar( 50 );
        scene.add( dirLight );

        dirLight.castShadow = true;
        dirLight.shadowMapWidth = 2048;
        dirLight.shadowMapHeight = 2048;
        dirLight.shadowCameraLeft = -d;
        dirLight.shadowCameraRight = d;
        dirLight.shadowCameraTop = d;
        dirLight.shadowCameraBottom = -d;
        dirLight.shadowCameraFar = 3500;
        dirLight.shadowBias = -0.0001;
        dirLight.shadowDarkness = 0.35;
        
        dirLight = new THREE.DirectionalLight( 0xffffff, 1 );
        dirLight.color.setHSL( 0.1, 1, 0.95 );
        dirLight.position.set( 1, -1.75, -1 );
        dirLight.position.multiplyScalar( 50 );
        scene.add( dirLight );

        dirLight.castShadow = true;
        dirLight.shadowMapWidth = 2048;
        dirLight.shadowMapHeight = 2048;
        dirLight.shadowCameraLeft = -d;
        dirLight.shadowCameraRight = d;
        dirLight.shadowCameraTop = d;
        dirLight.shadowCameraBottom = -d;
        dirLight.shadowCameraFar = 3500;
        dirLight.shadowBias = -0.0001;
        dirLight.shadowDarkness = 0.35;


      

        // SKYDOME
        var vertexShader = document.getElementById( 'vertexShader' ).textContent;
        var fragmentShader = document.getElementById( 'fragmentShader' ).textContent;
        var uniforms = {
          topColor: 	 { type: "c", value: new THREE.Color( 0x0077ff ) },
          bottomColor: { type: "c", value: new THREE.Color( 0xffffff ) },
          offset:		 { type: "f", value: 33 },
          exponent:	 { type: "f", value: 0.6 }
        };

        var skyGeo = new THREE.SphereGeometry( 4000, 32, 15 );
        var skyMat = new THREE.ShaderMaterial( { vertexShader: vertexShader, fragmentShader: fragmentShader, uniforms: uniforms, side: THREE.BackSide } );

        var sky = new THREE.Mesh( skyGeo, skyMat );
        scene.add( sky );
          

        var groundMatFromModel;
        // MODEL          
        var loader = new THREE.ColladaLoader();
        loader.options.convertUpAxis = true;
        loader.load( 'model.dae', function ( collada ) {
          console.log(collada);
          var dae = collada.dae.materials;
          for (var property in dae) {
            if (dae.hasOwnProperty(property) && dae[property].name == "Boden2") {
              groundMatFromModel = dae[property];
              console.log(groundMatFromModel)
            }
          }
          
          var daeScene = collada.scene;          
          daeScene.traverse(function(child){
              if (child instanceof THREE.Mesh){        
                  child.material.side = THREE.DoubleSide;        
              } 
          });       
          
          var skin = collada.skins[ 0 ];
          daeScene.position.set(0,0,0);
          daeScene.scale.set(1.5,1.5,1.5);
          scene.add(daeScene);
        });
           
          // GROUND
        var groundGeo = new THREE.PlaneBufferGeometry( 10000, 10000 );
        var groundMat = new THREE.MeshPhongMaterial( { color: 0xa3a472, specular: 0x050505 } );

        var ground = new THREE.Mesh( groundGeo, groundMat );
        ground.rotation.x = -Math.PI/2;
        ground.position.y = -33;
        scene.add( ground );  
         
        render();     

        function render() {
            var delta = clock.getDelta();

            renderer.clear();
            requestAnimationFrame(render);
            renderer.render(scene, camera);
            camControls.update(delta);
        }

    }
    window.onload = init;
</script>
</body>
</html>